<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Implementation Lab | Avantaland Academy</title>
    <link rel="stylesheet" href="styles/styles.css">
    <link rel="stylesheet" href="styles/biz-lab.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>.side-panel { z-index: 9999 !important; } .panel-overlay { z-index: 9998 !important; }</style>
</head>
<body>
    <!-- Header Placeholder -->
    <div id="header-placeholder"></div>

    <main class="lab-main">
        <div class="container lab-layout">
            <div class="lab-content">
                <!-- Mission Control HUD -->
                <section class="lab-hud fade-in">
                    <div class="hud-identity">
                        <div class="hud-label">AUDITING PROJECT</div>
                        <h1 id="lab-project-name">Loading Project...</h1>
                        <div class="hud-meta">
                            <div id="lab-rank" class="rank-badge">Initializing...</div>
                            <div id="lab-status" class="status-badge">Status: Checking...</div>
                        </div>
                    </div>
                    
                    <div class="hud-progress">
                        <div class="progress-ring-wrapper">
                            <svg class="progress-ring" width="120" height="120">
                                <circle class="progress-ring__circle--bg" stroke="#E2E8F0" stroke-width="8" fill="transparent" r="52" cx="60" cy="60"/>
                                <circle class="progress-ring__circle" stroke="var(--accent-blue)" stroke-width="8" fill="transparent" r="52" cx="60" cy="60"/>
                            </svg>
                            <div class="progress-value"><span id="lab-score">0</span>%</div>
                        </div>
                    </div>
                </section>

                <!-- Filter Controls -->
                <div class="lab-controls fade-in">
                    <button class="filter-btn active" data-filter="all">All Missions</button>
                    <button class="filter-btn" data-filter="priority">Priority Fixes</button>
                    <button class="filter-btn" data-filter="completed">Completed</button>
                </div>

                <!-- Truth Grid -->
                <section id="truth-grid" class="truth-grid fade-in">
                    <!-- Cards will be injected by JS -->
                </section>

                <!-- Advanced Lab (Locked) -->
                <section id="advanced-lab" class="advanced-lab fade-in" style="display:none;">
                    <!-- Injected by JS -->
                </section>
            </div>

            <!-- Community Bridge Sidebar -->
            <aside class="lab-sidebar fade-in">
                <h3>Live Lab Activity</h3>
                <div id="community-feed" class="community-feed"></div>
                
                <!-- Desktop Chat Interface -->
                <div class="lab-chat-widget mt-4">
                    <div class="chat-widget-header">
                        <h3>AI Consultant</h3>
                        <span class="live-indicator"></span>
                    </div>
                    <div id="main-chat-history" class="chat-widget-history">
                        <!-- Welcome message injected by JS -->
                    </div>
                    <div class="chat-widget-input">
                        <textarea id="main-chat-input" placeholder="Ask about strategy, finance..." rows="1"></textarea>
                        <button id="main-chat-send"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg></button>
                    </div>
                </div>
            </aside>
        </div>
    </main>

    <!-- Onboarding Modal -->
    <div id="onboarding-modal" class="lab-modal-overlay">
        <div class="lab-modal">
            <div class="modal-header">
                <h2>Create Your Lab Account</h2>
                <p>Initialize your project dashboard to start tracking progress.</p>
            </div>
            <form id="onboarding-form">
                <div class="form-group">
                    <label for="lab-email">Email Address</label>
                    <input type="email" id="lab-email" required placeholder="Enter the email you used for payment">
                </div>
                <div class="form-group">
                    <label for="lab-project">Project Name</label>
                    <input type="text" id="lab-project" required placeholder="e.g. Project Alpha">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Initialize Dashboard</button>
                <div id="onboarding-error" style="color: #ef4444; margin-top: 1rem; display: none; font-size: 0.9rem; text-align: center;"></div>
            </form>
        </div>
    </div>

    <!-- Truth Detail Side Panel -->
    <div id="truth-panel-overlay" class="panel-overlay"></div>
    <div id="truth-side-panel" class="side-panel">
        <button id="close-panel-btn" class="close-btn">&times;</button>
        <div class="panel-content">
            <div id="panel-header" class="panel-header">
                <span id="panel-truth-number" class="truth-badge">Truth #01</span>
                <h2 id="panel-truth-title">The Problem Solved</h2>
            </div>
            <div id="panel-body"></div>
        </div>
    </div>

    <!-- Mobile Chat FAB & Interface -->
    <button id="mobile-chat-fab" class="mobile-chat-fab">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
    </button>

    <div id="mobile-chat-interface" class="mobile-chat-interface">
        <div class="mobile-chat-header">
            <h3>AI Consultant</h3>
            <button id="close-mobile-chat">&times;</button>
        </div>
        <div id="mobile-chat-history" class="chat-widget-history"></div>
        <div class="chat-widget-input">
            <textarea id="mobile-chat-input" placeholder="Type your question..." rows="1"></textarea>
            <button id="mobile-chat-send"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg></button>
        </div>
    </div>

    <script src="scripts/script.js"></script>
    <script src="scripts/config.js"></script>
    <script src="scripts/biz-lab.js"></script>
</body>
</html>